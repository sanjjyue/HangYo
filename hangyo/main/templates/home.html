{%load static%}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>hangyo</title>
    <link rel="stylesheet" href="{% static 'css/home.css' %}">
</head>
<body>
    <div class="wrapped">
        <div class="map">
            <div id="map" style="width:480px;height:800px;display:inline-block;text-align:center;"></div>
            <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=a1e71c3e49ea6232c6622dd828be2a59"></script>
            <script>
                var container = document.getElementById('map');
                var options = {
                    center: new kakao.maps.LatLng(35.234104, 129.078411),
                    level: 3
                };
                // public static final MapView.CurrentLocationTrackingMode TrackingModeOnWithHeading
                var map = new kakao.maps.Map(container, options);
                
                //마커 속성
                var imageSrc = "{% static 'marker_store.png' %}",
                    imageSize = new kakao.maps.Size(55,64), 
                    imageOption = {offset: new kakao.maps.Point(27, 69)}; //좌표랑 일치시킬 마커내의 좌표
                var markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize, imageOption)
                //현위치 마커속성
                var imageSrc1 = "{% static 'marker_me.png' %}",
                    imageSize1 = new kakao.maps.Size(20,20), 
                    imageOption1 = {offset: new kakao.maps.Point(27, 69)}; //좌표랑 일치시킬 마커내의 좌표
                var markerImage1 = new kakao.maps.MarkerImage(imageSrc1, imageSize1, imageOption1)
                
                //현재위치 마커표시
                if (navigator.geolocation) {
                // 접속위치 얻어오기
                    navigator.geolocation.getCurrentPosition(function(position) {
                        
                        var lat = position.coords.latitude, // 위도
                            lon = position.coords.longitude; // 경도
                        
                        var locPosition = new kakao.maps.LatLng(lat, lon);
                        
                        displayMarker(locPosition, message); 
                            
                    });
                    
                } else { //GeoLocation을 사용할 수 없을때
                    
                    var locPosition = new kakao.maps.LatLng(33.450701, 126.570667),    
                        message = 'geolocation을 사용할수 없어요..'
                        
                    displayMarker(locPosition, message);
                }     
                function displayMarker(locPosition, message) {
        
                // 마커 생성
                var marker1 = new kakao.maps.Marker({  
                    map: map, 
                    image:markerImage1,
                    position: locPosition
                }); 
        
                marker1.setMap(map);  
                
                var iwContent1 = message, // 표시 내용
                    iwRemoveable1 = true;
        
                // 지도 중심좌표 현재위치 이동
                map.setCenter(locPosition);      
                }    
        
                
        
                // 버튼생성 후 특정 위치로 부드럽게 이동
                function panTo(lat,lon) { 
                    var moveLatLon = new kakao.maps.LatLng(lat,lon);
                    map.panTo(moveLatLon);}       
                // 지도 줌
                var zoomControl = new kakao.maps.ZoomControl();
                map.addControl(zoomControl, kakao.maps.ControlPosition.RIGHT);
                //마커 관련 툴
                var positions = [
                    {
                    content: '<div>부산대</div>', 
                    latlng: new kakao.maps.LatLng(35.234104, 129.078411)
                    },
                    {
                    content: '<div>카페드팽</div>', 
                    latlng: new kakao.maps.LatLng(35.230288, 129.084147)
                    },
                    {
                    content: '<div>벅구냥냥펀치</div>', 
                    latlng: new kakao.maps.LatLng(35.231172, 129.085223)
                    }
                ];
        
                // 마커 생성
                for (var i = 0; i < positions.length; i ++) {
                    var marker = new kakao.maps.Marker({
                        position: positions[i].latlng, 
                        image: markerImage, 
                        clickable: true
                    });
                    var iwRemoveable = true; // true일 때 X버튼 생성
                    // 인포윈도우를 생성
                    var infowindow = new kakao.maps.InfoWindow({
                        content : positions[i].content,
                        removable : iwRemoveable
                    });
                    marker.setMap(map);  
                    kakao.maps.event.addListener(marker, 'click', clickListener(map,marker,infowindow));
                }
                function clickListener(map,marker,infowindow){
                    return function(){
                        infowindow.open(map, marker,infowindow);
                    };
                }
            </script>
        </div>
        
        <div class="category">
            <button class="btn_myloca" onclick="panTo()">내 위치</button>
            <button class="btn_resetinfo">정보 재설정하기</button>
            <button class="btn_checkbalance">잔액 확인</button>
        </div>
    </div>



    
    <!-- 팝업되는 창 -->
    <div class="popup_resetinfo">
        <div class="popupbox">
            <span class="close-button_1">&times;</span>
            <!-- <img class="icon" src=""> 종이비행기아이콘 넣기 -->
            <h1 class="title">간편 정보 저장</h1>
            <form action="#post.php" method="POST">
                <label></label>
                <input type="text" name="name" placeholder="이름" required="required">
                <label></label>
                <input type="text" name="location" placeholder="장소" required="required">
                <label></label>
                <input type="text" name="cardnumber" placeholder="카드번호(012345678901)" required="required">
                <label></label>
                <!-- <div class="">
                    정보사용 설명
                </div> -->
                <input type="button" id="close-button_save" value="정보 저장하기">
            </form>
        </div>
    </div>

    <div class="popup_checkbalance">
        <div class="popupbox">
            <span class="close-button_2">&times;</span>
            <img class="icon" src=""> 동전아이콘 넣기
            <h1 class="title">잔액확인</h1>
            
            <form action="#post.php" method="POST">
                <h5>
                    이름,잔액 받아오기
                    김태훈님의 현재 계좌잔액은 
                    999,999원 입니다.
                </h5>
                <input type="button" id="close-button_Iknow" class="close-button_Iknow"value="알겠어요!">
            </form>
        </div>
    </div>

    <script type="text/javascript">
        var popup_resetinfo = document.querySelector(".popup_resetinfo"); 
        var btn_resetinfo = document.querySelector(".btn_resetinfo"); 
        var popup_checkbalance = document.querySelector(".popup_checkbalance");                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                p_checkbalance = document.querySelector(".popup_checkbalance");
        var btn_checkbalance = document.querySelector(".btn_checkbalance");
        var closeButton_1 = document.querySelector(".close-button_1");
        var closeButton_2 = document.querySelector(".close-button_2");
        var closeButton_Iknow = document.querySelector(".close-button_Iknow");

        function toggle_resetinfo(){
            popup_resetinfo.classList.toggle("show-popup_resetinfo");
        }

        function btn_resetinfo_OnClick(event) {
            if (event.target === popup_resetinfo) {
                toggle_resetinfo();
            }
        }

        function toggle_checkbalance(){
            popup_checkbalance.classList.toggle("show-popup_checkbalance");
        }

        function btn_checkbalance_OnClick(event) {
            if (event.target === popup_checkbalance) {
                toggle_checkbalance();
            }
        }

        btn_resetinfo.addEventListener("click", toggle_resetinfo);
        closeButton_1.addEventListener("click", toggle_resetinfo);
        btn_checkbalance.addEventListener("click", toggle_checkbalance);
        closeButton_2.addEventListener("click", toggle_checkbalance);
        closeButton_Iknow.addEventListener("click", toggle_checkbalance);
        // 팝업창 밖에 부분 눌렀을 때 팝업창 꺼짐
        window.addEventListener("click", btn_resetinfo_OnClick);
        window.addEventListener("click", btn_checkbalance_OnClick);
    </script>
</body>
</html>